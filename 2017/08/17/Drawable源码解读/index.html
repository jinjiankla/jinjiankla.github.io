<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="RTFSC (Read the fucking source code )," />





  <link rel="alternate" href="/atom.xml" title="Desire" type="application/atom+xml" />






<meta name="description" content="前言Android里最常用的5大包名 package: android.animation android.text android.view android.widget android.graphics 本篇介绍android.graphics当中的drawable  Though usually not visible to the application, Drawables may ta">
<meta name="keywords" content="RTFSC (Read the fucking source code )">
<meta property="og:type" content="article">
<meta property="og:title" content="Drawable源码解读">
<meta property="og:url" content="http://jinjian.info/2017/08/17/Drawable源码解读/index.html">
<meta property="og:site_name" content="Desire">
<meta property="og:description" content="前言Android里最常用的5大包名 package: android.animation android.text android.view android.widget android.graphics 本篇介绍android.graphics当中的drawable  Though usually not visible to the application, Drawables may ta">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://jinjian.info/images/Drawable_Method.png">
<meta property="og:image" content="http://jinjian.info/images/Drawable_OverView.png">
<meta property="og:image" content="http://jinjian.info/images/Drawable_Shape.png">
<meta property="og:image" content="http://jinjian.info/images/Drawable_Struct.png">
<meta property="og:updated_time" content="2017-12-23T19:39:18.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Drawable源码解读">
<meta name="twitter:description" content="前言Android里最常用的5大包名 package: android.animation android.text android.view android.widget android.graphics 本篇介绍android.graphics当中的drawable  Though usually not visible to the application, Drawables may ta">
<meta name="twitter:image" content="http://jinjian.info/images/Drawable_Method.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://jinjian.info/2017/08/17/Drawable源码解读/"/>





  <title>Drawable源码解读 | Desire</title>
  




 <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?ddb5ad830b0accecaab2b551afd8c824";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>



</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Desire</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://jinjian.info/2017/08/17/Drawable源码解读/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jinjian">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/my_logo.svg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Desire">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Drawable源码解读</h1>
        

        <div class="post-meta">
         
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-17T00:00:00+08:00">
                2017-08-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/读别人的源码，涨自己的智慧/" itemprop="url" rel="index">
                    <span itemprop="name">读别人的源码，涨自己的智慧</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

  


          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  5,187字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  31分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>Android里最常用的5大包名</p>
<p>package:</p>
<p>android.animation</p>
<p>android.text</p>
<p>android.view</p>
<p>android.widget</p>
<p>android.graphics</p>
<p>本篇介绍android.graphics当中的drawable</p>
<blockquote>
<p>Though usually not visible to the application, Drawables may take a variety</p>
<p>of forms:</p>
<ul>
<li>Bitmap: the simplest Drawable, a PNG or JPEG image.</li>
<li><p>Nine Patch: an extension to the PNG format allows it to</p>
<p> specify information about how to stretch it and place things inside of</p>
<p> it.</p>
</li>
<li><p>Shape: contains simple drawing commands instead of a raw</p>
<p> bitmap, allowing it to resize better in some cases.</p>
</li>
<li><p>Layers: a compound drawable, which draws multiple underlying</p>
<p> drawables on top of each other.</p>
</li>
<li><p>States: a compound drawable that selects one of a set of</p>
<p> drawables based on its state.</p>
</li>
<li><p>Levels: a compound drawable that selects one of a set of</p>
<p> drawables based on its level.</p>
</li>
<li><p>Scale: a compound drawable with a single child drawable,</p>
<p> whose overall size is modified based on the current level.</p>
</li>
</ul>
</blockquote>
<h3 id="Drawable方法论"><a href="#Drawable方法论" class="headerlink" title="Drawable方法论"></a>Drawable方法论</h3><h4 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h4><p><img src="/images/Drawable_Method.png" alt="Drawable_Method"></p>
<h3 id="Drawable的子类们"><a href="#Drawable的子类们" class="headerlink" title="Drawable的子类们"></a>Drawable的子类们</h3><h4 id="大纲"><a href="#大纲" class="headerlink" title="大纲"></a>大纲</h4><p><img src="/images/Drawable_OverView.png" alt="Drawable_OverView"></p>
<h4 id="ShapeDrawable"><a href="#ShapeDrawable" class="headerlink" title="ShapeDrawable"></a>ShapeDrawable</h4><h5 id="draw"><a href="#draw" class="headerlink" title="draw"></a>draw</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">(Canvas canvas)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> Rect r = getBounds();<span class="comment">//get how large with location</span></span><br><span class="line">    <span class="keyword">final</span> ShapeState state = mShapeState;</span><br><span class="line">    <span class="keyword">final</span> Paint paint = state.mPaint;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> prevAlpha = paint.getAlpha();</span><br><span class="line">    paint.setAlpha(modulateAlpha(prevAlpha, state.mAlpha));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// only draw shape if it may affect output</span></span><br><span class="line">    <span class="keyword">if</span> (paint.getAlpha() != <span class="number">0</span> || paint.getXfermode() != <span class="keyword">null</span> || paint.hasShadowLayer()) &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">boolean</span> clearColorFilter;</span><br><span class="line">        <span class="keyword">if</span> (mTintFilter != <span class="keyword">null</span> &amp;&amp; paint.getColorFilter() == <span class="keyword">null</span>) &#123;</span><br><span class="line">            paint.setColorFilter(mTintFilter);</span><br><span class="line">            clearColorFilter = <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            clearColorFilter = <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (state.mShape != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">// need the save both for the translate, and for the (unknown)</span></span><br><span class="line">            <span class="comment">// Shape</span></span><br><span class="line">            <span class="keyword">final</span> <span class="keyword">int</span> count = canvas.save();</span><br><span class="line">            canvas.translate(r.left, r.top);</span><br><span class="line">            onDraw(state.mShape, canvas, paint);<span class="comment">// see below</span></span><br><span class="line">            canvas.restoreToCount(count);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            canvas.drawRect(r, paint);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (clearColorFilter) &#123;</span><br><span class="line">            paint.setColorFilter(<span class="keyword">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// restore</span></span><br><span class="line">    paint.setAlpha(prevAlpha);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="onDraw"><a href="#onDraw" class="headerlink" title="onDraw"></a>onDraw</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Called from the drawable's draw() method after the canvas has been set to</span></span><br><span class="line"><span class="comment">   * draw the shape at (0,0). Subclasses can override for special effects such</span></span><br><span class="line"><span class="comment">   * as multiple layers, stroking, etc.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDraw</span><span class="params">(Shape shape, Canvas canvas, Paint paint)</span> </span>&#123;</span><br><span class="line">      shape.draw(canvas, paint);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h5 id="shape与shapeDrawable"><a href="#shape与shapeDrawable" class="headerlink" title="shape与shapeDrawable"></a>shape与shapeDrawable</h5><p><img src="/images/Drawable_Shape.png" alt="Drawable_Shape"></p>
<h5 id="ShapeState"><a href="#ShapeState" class="headerlink" title="ShapeState"></a>ShapeState</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * Defines the intrinsic properties of this ShapeDrawable's Shape.</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="keyword">final</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ShapeState</span> <span class="keyword">extends</span> <span class="title">ConstantState</span> </span>&#123;</span><br><span class="line">     <span class="keyword">int</span>[] mThemeAttrs;</span><br><span class="line">     <span class="keyword">int</span> mChangingConfigurations;</span><br><span class="line">     Paint mPaint;</span><br><span class="line">     Shape mShape;</span><br><span class="line">     ColorStateList mTint = <span class="keyword">null</span>;</span><br><span class="line">     Mode mTintMode = DEFAULT_TINT_MODE;</span><br><span class="line">     Rect mPadding;</span><br><span class="line">     <span class="keyword">int</span> mIntrinsicWidth;</span><br><span class="line">     <span class="keyword">int</span> mIntrinsicHeight;</span><br><span class="line">     <span class="keyword">int</span> mAlpha = <span class="number">255</span>;</span><br><span class="line">     ShaderFactory mShaderFactory;</span><br><span class="line"></span><br><span class="line">     ShapeState(ShapeState orig) &#123;</span><br><span class="line">         <span class="keyword">if</span> (orig != <span class="keyword">null</span>) &#123;</span><br><span class="line">             mThemeAttrs = orig.mThemeAttrs;</span><br><span class="line">             mPaint = orig.mPaint;</span><br><span class="line">             mShape = orig.mShape;</span><br><span class="line">             mTint = orig.mTint;</span><br><span class="line">             mTintMode = orig.mTintMode;</span><br><span class="line">             mPadding = orig.mPadding;</span><br><span class="line">             mIntrinsicWidth = orig.mIntrinsicWidth;</span><br><span class="line">             mIntrinsicHeight = orig.mIntrinsicHeight;</span><br><span class="line">             mAlpha = orig.mAlpha;</span><br><span class="line">             mShaderFactory = orig.mShaderFactory;</span><br><span class="line">         &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">             mPaint = <span class="keyword">new</span> Paint(Paint.ANTI_ALIAS_FLAG);</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="meta">@Override</span></span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">canApplyTheme</span><span class="params">()</span> </span>&#123;</span><br><span class="line">         <span class="keyword">return</span> mThemeAttrs != <span class="keyword">null</span></span><br><span class="line">                 || (mTint != <span class="keyword">null</span> &amp;&amp; mTint.canApplyTheme());</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="meta">@Override</span></span><br><span class="line">     <span class="function"><span class="keyword">public</span> Drawable <span class="title">newDrawable</span><span class="params">()</span> </span>&#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="keyword">new</span> ShapeDrawable(<span class="keyword">this</span>, <span class="keyword">null</span>);</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="meta">@Override</span></span><br><span class="line">     <span class="function"><span class="keyword">public</span> Drawable <span class="title">newDrawable</span><span class="params">(Resources res)</span> </span>&#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="keyword">new</span> ShapeDrawable(<span class="keyword">this</span>, res);</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="meta">@Override</span></span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getChangingConfigurations</span><span class="params">()</span> </span>&#123;</span><br><span class="line">         <span class="keyword">return</span> mChangingConfigurations</span><br><span class="line">                 | (mTint != <span class="keyword">null</span> ? mTint.getChangingConfigurations() : <span class="number">0</span>);</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<h4 id="ColorDrawable"><a href="#ColorDrawable" class="headerlink" title="ColorDrawable"></a>ColorDrawable</h4><h5 id="draw-1"><a href="#draw-1" class="headerlink" title="draw"></a>draw</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">(Canvas canvas)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> ColorFilter colorFilter = mPaint.getColorFilter();</span><br><span class="line">    <span class="keyword">if</span> ((mColorState.mUseColor &gt;&gt;&gt; <span class="number">24</span>) != <span class="number">0</span> || colorFilter != <span class="keyword">null</span> || mTintFilter != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (colorFilter == <span class="keyword">null</span>) &#123;</span><br><span class="line">            mPaint.setColorFilter(mTintFilter);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        mPaint.setColor(mColorState.mUseColor);</span><br><span class="line">        canvas.drawRect(getBounds(), mPaint);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Restore original color filter.</span></span><br><span class="line">        mPaint.setColorFilter(colorFilter);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="BitmapDrawable"><a href="#BitmapDrawable" class="headerlink" title="BitmapDrawable"></a>BitmapDrawable</h4><h5 id="draw-2"><a href="#draw-2" class="headerlink" title="draw"></a>draw</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">(Canvas canvas)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> Bitmap bitmap = mBitmapState.mBitmap;</span><br><span class="line">        <span class="keyword">if</span> (bitmap == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> BitmapState state = mBitmapState;</span><br><span class="line">      <span class="comment">// config with shader</span></span><br><span class="line">        <span class="keyword">final</span> Paint paint = state.mPaint;</span><br><span class="line">        <span class="keyword">if</span> (state.mRebuildShader) &#123;</span><br><span class="line">            <span class="keyword">final</span> Shader.TileMode tmx = state.mTileModeX;</span><br><span class="line">            <span class="keyword">final</span> Shader.TileMode tmy = state.mTileModeY;</span><br><span class="line">            <span class="keyword">if</span> (tmx == <span class="keyword">null</span> &amp;&amp; tmy == <span class="keyword">null</span>) &#123;</span><br><span class="line">                paint.setShader(<span class="keyword">null</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                paint.setShader(<span class="keyword">new</span> BitmapShader(bitmap,</span><br><span class="line">                        tmx == <span class="keyword">null</span> ? Shader.TileMode.CLAMP : tmx,</span><br><span class="line">                        tmy == <span class="keyword">null</span> ? Shader.TileMode.CLAMP : tmy));</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            state.mRebuildShader = <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">//config with alpha</span></span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> restoreAlpha;</span><br><span class="line">        <span class="keyword">if</span> (state.mBaseAlpha != <span class="number">1.0f</span>) &#123;</span><br><span class="line">            <span class="keyword">final</span> Paint p = getPaint();</span><br><span class="line">            restoreAlpha = p.getAlpha();</span><br><span class="line">            p.setAlpha((<span class="keyword">int</span>) (restoreAlpha * state.mBaseAlpha + <span class="number">0.5f</span>));</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            restoreAlpha = -<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">//config with colorFilter</span></span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">boolean</span> clearColorFilter;</span><br><span class="line">        <span class="keyword">if</span> (mTintFilter != <span class="keyword">null</span> &amp;&amp; paint.getColorFilter() == <span class="keyword">null</span>) &#123;</span><br><span class="line">            paint.setColorFilter(mTintFilter);</span><br><span class="line">            clearColorFilter = <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            clearColorFilter = <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        updateDstRectAndInsetsIfDirty();</span><br><span class="line">        <span class="keyword">final</span> Shader shader = paint.getShader();</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">boolean</span> needMirroring = needMirroring();</span><br><span class="line">        <span class="keyword">if</span> (shader == <span class="keyword">null</span>) &#123;</span><br><span class="line">          <span class="comment">// deal with mirroring</span></span><br><span class="line">            <span class="keyword">if</span> (needMirroring) &#123;</span><br><span class="line">                canvas.save();</span><br><span class="line">                <span class="comment">// Mirror the bitmap</span></span><br><span class="line">                canvas.translate(mDstRect.right - mDstRect.left, <span class="number">0</span>);</span><br><span class="line">                canvas.scale(-<span class="number">1.0f</span>, <span class="number">1.0f</span>);</span><br><span class="line">            &#125;</span><br><span class="line"><span class="comment">// draw bitmap</span></span><br><span class="line">            canvas.drawBitmap(bitmap, <span class="keyword">null</span>, mDstRect, paint);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (needMirroring) &#123;</span><br><span class="line">                canvas.restore();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (needMirroring) &#123;</span><br><span class="line">                <span class="comment">// Mirror the bitmap</span></span><br><span class="line">                updateMirrorMatrix(mDstRect.right - mDstRect.left);</span><br><span class="line">                shader.setLocalMatrix(mMirrorMatrix);</span><br><span class="line">                paint.setShader(shader);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (mMirrorMatrix != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    mMirrorMatrix = <span class="keyword">null</span>;</span><br><span class="line">                    shader.setLocalMatrix(Matrix.IDENTITY_MATRIX);</span><br><span class="line">                    paint.setShader(shader);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            canvas.drawRect(mDstRect, paint);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">//resotre </span></span><br><span class="line">        <span class="keyword">if</span> (clearColorFilter) &#123;</span><br><span class="line">            paint.setColorFilter(<span class="keyword">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (restoreAlpha &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">            paint.setAlpha(restoreAlpha);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h4 id="LayerDrawable"><a href="#LayerDrawable" class="headerlink" title="LayerDrawable"></a>LayerDrawable</h4><h5 id="draw-3"><a href="#draw-3" class="headerlink" title="draw"></a>draw</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">(Canvas canvas)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> ChildDrawable[] array = mLayerState.mChildren;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> N = mLayerState.mNum;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++) &#123;</span><br><span class="line">        <span class="keyword">final</span> Drawable dr = array[i].mDrawable;</span><br><span class="line">        <span class="keyword">if</span> (dr != <span class="keyword">null</span>) &#123;</span><br><span class="line">            dr.draw(canvas);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="LayerState"><a href="#LayerState" class="headerlink" title="LayerState"></a>LayerState</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">  <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">LayerState</span> <span class="keyword">extends</span> <span class="title">ConstantState</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> mNum;</span><br><span class="line">        ChildDrawable[] mChildren;</span><br><span class="line">        <span class="keyword">int</span>[] mThemeAttrs;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> mPaddingTop = -<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> mPaddingBottom = -<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> mPaddingLeft = -<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> mPaddingRight = -<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> mPaddingStart = -<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> mPaddingEnd = -<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> mOpacityOverride = PixelFormat.UNKNOWN;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> mChangingConfigurations;</span><br><span class="line">        <span class="keyword">int</span> mChildrenChangingConfigurations;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">boolean</span> mHaveOpacity;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">int</span> mOpacity;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">boolean</span> mHaveIsStateful;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">boolean</span> mIsStateful;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">boolean</span> mAutoMirrored = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">int</span> mPaddingMode = PADDING_MODE_NEST;</span><br><span class="line"><span class="string">'</span></span><br><span class="line"><span class="string">        LayerState(LayerState orig, LayerDrawable owner, Resources res) &#123;</span></span><br><span class="line"><span class="string">            if (orig != null) &#123;</span></span><br><span class="line"><span class="string">                final ChildDrawable[] origChildDrawable = orig.mChildren;</span></span><br><span class="line"><span class="string">                final int N = orig.mNum;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                mNum = N;</span></span><br><span class="line"><span class="string">                mChildren = new ChildDrawable[N];</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                mChangingConfigurations = orig.mChangingConfigurations;</span></span><br><span class="line"><span class="string">                mChildrenChangingConfigurations = orig.mChildrenChangingConfigurations;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                for (int i = 0; i &lt; N; i++) &#123;</span></span><br><span class="line"><span class="string">                    final ChildDrawable or = origChildDrawable[i];</span></span><br><span class="line"><span class="string">                    mChildren[i] = new ChildDrawable(or, owner, res);</span></span><br><span class="line"><span class="string">                &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                mHaveOpacity = orig.mHaveOpacity;</span></span><br><span class="line"><span class="string">                mOpacity = orig.mOpacity;</span></span><br><span class="line"><span class="string">                mHaveIsStateful = orig.mHaveIsStateful;</span></span><br><span class="line"><span class="string">                mIsStateful = orig.mIsStateful;</span></span><br><span class="line"><span class="string">                mAutoMirrored = orig.mAutoMirrored;</span></span><br><span class="line"><span class="string">                mPaddingMode = orig.mPaddingMode;</span></span><br><span class="line"><span class="string">                mThemeAttrs = orig.mThemeAttrs;</span></span><br><span class="line"><span class="string">                mPaddingTop = orig.mPaddingTop;</span></span><br><span class="line"><span class="string">                mPaddingBottom = orig.mPaddingBottom;</span></span><br><span class="line"><span class="string">                mPaddingLeft = orig.mPaddingLeft;</span></span><br><span class="line"><span class="string">                mPaddingRight = orig.mPaddingRight;</span></span><br><span class="line"><span class="string">                mPaddingStart = orig.mPaddingStart;</span></span><br><span class="line"><span class="string">                mPaddingEnd = orig.mPaddingEnd;</span></span><br><span class="line"><span class="string">                mOpacityOverride = orig.mOpacityOverride;</span></span><br><span class="line"><span class="string">            &#125; else &#123;</span></span><br><span class="line"><span class="string">                mNum = 0;</span></span><br><span class="line"><span class="string">                mChildren = null;</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">           '</span><span class="string">''</span><span class="string">''</span><span class="string">''</span><span class="string">''</span><span class="string">''</span><span class="string">''</span><span class="string">''</span><span class="string">''</span><span class="string">''</span><span class="string">''</span><span class="string">''</span><span class="string">''</span><span class="string">''</span><span class="string">''</span><span class="string">''</span><span class="string">''</span><span class="string">''</span><span class="string">''</span><span class="string">''</span><span class="string">''</span><span class="string">''</span><span class="string">''</span><span class="string">''</span><span class="string">''</span><span class="string">''</span><span class="string">'</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
<h4 id="VertorDrawable"><a href="#VertorDrawable" class="headerlink" title="VertorDrawable"></a>VertorDrawable</h4><h5 id="如何建立矢量树"><a href="#如何建立矢量树" class="headerlink" title="如何建立矢量树"></a>如何建立矢量树</h5><h6 id="相关类"><a href="#相关类" class="headerlink" title="相关类"></a>相关类</h6><p><img src="/images/Drawable_Struct.png" alt="Drawable_Struct"></p>
<h6 id="建树"><a href="#建树" class="headerlink" title="建树"></a>建树</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line">eg：</span><br><span class="line"> * &lt;vector xmlns:android=<span class="string">"http://schemas.android.com/apk/res/android"</span></span><br><span class="line"> *     android:height=<span class="string">"64dp"</span></span><br><span class="line"> *     android:width=<span class="string">"64dp"</span></span><br><span class="line"> *     android:viewportHeight=<span class="string">"600"</span></span><br><span class="line"> *     android:viewportWidth=<span class="string">"600"</span> &gt;</span><br><span class="line"> *     &lt;group</span><br><span class="line"> *         android:name=<span class="string">"rotationGroup"</span></span><br><span class="line"> *         android:pivotX=<span class="string">"300.0"</span></span><br><span class="line"> *         android:pivotY=<span class="string">"300.0"</span></span><br><span class="line"> *         android:rotation=<span class="string">"45.0"</span> &gt;</span><br><span class="line"> *         &lt;path</span><br><span class="line"> *             android:name=<span class="string">"v"</span></span><br><span class="line"> *             android:fillColor=<span class="string">"#000000"</span></span><br><span class="line"> *             android:pathData=<span class="string">"M300,70 l 0,-70 70,70 0,0 -70,70z"</span> /&gt;</span><br><span class="line"> *     &lt;/group&gt;</span><br><span class="line"> * &lt;/vector&gt;</span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">inflateInternal</span><span class="params">(Resources res, XmlPullParser parser, AttributeSet attrs,</span></span></span><br><span class="line"><span class="function"><span class="params">            Theme theme)</span> <span class="keyword">throws</span> XmlPullParserException, IOException </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> VectorDrawableState state = mVectorState;</span><br><span class="line">        <span class="keyword">final</span> VPathRenderer pathRenderer = state.mVPathRenderer;</span><br><span class="line">        <span class="keyword">boolean</span> noPathTag = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// important Use a stack to help to build the group tree.</span></span><br><span class="line">        <span class="comment">// The top of the stack is always the current group.</span></span><br><span class="line">        <span class="keyword">final</span> Stack&lt;VGroup&gt; groupStack = <span class="keyword">new</span> Stack&lt;VGroup&gt;();</span><br><span class="line">      <span class="comment">//use mRootGroup to store the sequense of shi children and grandchild</span></span><br><span class="line">        groupStack.push(pathRenderer.mRootGroup);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> eventType = parser.getEventType();</span><br><span class="line">        <span class="keyword">while</span> (eventType != XmlPullParser.END_DOCUMENT) &#123;</span><br><span class="line">            <span class="keyword">if</span> (eventType == XmlPullParser.START_TAG) &#123;</span><br><span class="line">                <span class="keyword">final</span> String tagName = parser.getName();</span><br><span class="line">              <span class="comment">//get nearest parent</span></span><br><span class="line">                <span class="keyword">final</span> VGroup currentGroup = groupStack.peek();</span><br><span class="line">                <span class="comment">//"path"</span></span><br><span class="line">                <span class="keyword">if</span> (SHAPE_PATH.equals(tagName)) &#123;</span><br><span class="line">                    <span class="keyword">final</span> VFullPath path = <span class="keyword">new</span> VFullPath();</span><br><span class="line">                    path.inflate(res, attrs, theme);</span><br><span class="line">                    currentGroup.mChildren.add(path);</span><br><span class="line">                    <span class="keyword">if</span> (path.getPathName() != <span class="keyword">null</span>) &#123;</span><br><span class="line">                      <span class="comment">// store the detail infomation of path data for via inflate</span></span><br><span class="line">                        pathRenderer.mVGTargetsMap.put(path.getPathName(), path);</span><br><span class="line">                    &#125;</span><br><span class="line">                    noPathTag = <span class="keyword">false</span>;</span><br><span class="line">                    state.mChangingConfigurations |= path.mChangingConfigurations;</span><br><span class="line">                &#125; </span><br><span class="line">              <span class="comment">//"clip-path"</span></span><br><span class="line">              <span class="keyword">else</span> <span class="keyword">if</span> (SHAPE_CLIP_PATH.equals(tagName)) &#123;</span><br><span class="line">                    <span class="keyword">final</span> VClipPath path = <span class="keyword">new</span> VClipPath();</span><br><span class="line">                    path.inflate(res, attrs, theme);</span><br><span class="line">                    currentGroup.mChildren.add(path);</span><br><span class="line">                    <span class="keyword">if</span> (path.getPathName() != <span class="keyword">null</span>) &#123;</span><br><span class="line">                        pathRenderer.mVGTargetsMap.put(path.getPathName(), path);</span><br><span class="line">                    &#125;</span><br><span class="line">                    state.mChangingConfigurations |= path.mChangingConfigurations;</span><br><span class="line">                &#125;</span><br><span class="line">              <span class="comment">//"group"</span></span><br><span class="line">              <span class="keyword">else</span> <span class="keyword">if</span> (SHAPE_GROUP.equals(tagName)) &#123;</span><br><span class="line">                    VGroup newChildGroup = <span class="keyword">new</span> VGroup();</span><br><span class="line">                    newChildGroup.inflate(res, attrs, theme);</span><br><span class="line">                    currentGroup.mChildren.add(newChildGroup);</span><br><span class="line">                 <span class="comment">//update nearest tree parent</span></span><br><span class="line">                    groupStack.push(newChildGroup);</span><br><span class="line">                    <span class="keyword">if</span> (newChildGroup.getGroupName() != <span class="keyword">null</span>) &#123;</span><br><span class="line">                        pathRenderer.mVGTargetsMap.put(newChildGroup.getGroupName(),</span><br><span class="line">                                newChildGroup);</span><br><span class="line">                    &#125;</span><br><span class="line">                    state.mChangingConfigurations |= newChildGroup.mChangingConfigurations;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (eventType == XmlPullParser.END_TAG) &#123;</span><br><span class="line">                <span class="keyword">final</span> String tagName = parser.getName();</span><br><span class="line">                <span class="keyword">if</span> (SHAPE_GROUP.equals(tagName)) &#123;</span><br><span class="line">                  <span class="comment">// tree parent added all its children and remove from the stack </span></span><br><span class="line">                    groupStack.pop();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            eventType = parser.next();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Print the tree out for debug.</span></span><br><span class="line">        <span class="keyword">if</span> (DBG_VECTOR_DRAWABLE) &#123;</span><br><span class="line">            printGroupTree(pathRenderer.mRootGroup, <span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (noPathTag) &#123;</span><br><span class="line">            <span class="keyword">final</span> StringBuffer tag = <span class="keyword">new</span> StringBuffer();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (tag.length() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                tag.append(<span class="string">" or "</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            tag.append(SHAPE_PATH);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> XmlPullParserException(<span class="string">"no "</span> + tag + <span class="string">" defined"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h5 id="如何画"><a href="#如何画" class="headerlink" title="如何画"></a>如何画</h5><p>VectorDrawable:draw(Canvas ) -&gt;VectorDrawable:updateCachedBitmap(int width, int height)</p>
<p>-&gt;VPathRenderer:draw(Canvas canvas, int w, int h, ColorFilter filter)</p>
<p>-&gt;VPathRenderer:drawGroupTree(VGroup , Matrix,  Canvas, int w, int h, ColorFilter)</p>
<p>-&gt;VPathRenderer:drawPath(VGroup, VPath, Canvas, int w, int h,  ColorFilter)</p>
<h6 id="step-1-确定canvas-的宽高"><a href="#step-1-确定canvas-的宽高" class="headerlink" title="step 1: 确定canvas 的宽高"></a>step 1: 确定canvas 的宽高</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">(Canvas canvas)</span> </span>&#123;</span><br><span class="line">     <span class="comment">// We will offset the bounds for drawBitmap, so copyBounds() here instead</span></span><br><span class="line">     <span class="comment">// of getBounds().</span></span><br><span class="line">     copyBounds(mTmpBounds);</span><br><span class="line">     <span class="keyword">if</span> (mTmpBounds.width() &lt;= <span class="number">0</span> || mTmpBounds.height() &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">         <span class="comment">// Nothing to draw</span></span><br><span class="line">         <span class="keyword">return</span>;</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="comment">// Color filters always override tint filters.</span></span><br><span class="line">     <span class="keyword">final</span> ColorFilter colorFilter = (mColorFilter == <span class="keyword">null</span> ? mTintFilter : mColorFilter);</span><br><span class="line"></span><br><span class="line">     <span class="comment">// The imageView can scale the canvas in different ways, in order to</span></span><br><span class="line">     <span class="comment">// avoid blurry scaling, we have to draw into a bitmap with exact pixel</span></span><br><span class="line">     <span class="comment">// size first. This bitmap size is determined by the bounds and the</span></span><br><span class="line">     <span class="comment">// canvas scale. </span></span><br><span class="line">    <span class="comment">//特殊处理imageview的显示情况</span></span><br><span class="line">     canvas.getMatrix(mTmpMatrix);</span><br><span class="line">     mTmpMatrix.getValues(mTmpFloats);</span><br><span class="line">     <span class="keyword">float</span> canvasScaleX = Math.abs(mTmpFloats[Matrix.MSCALE_X]);</span><br><span class="line">     <span class="keyword">float</span> canvasScaleY = Math.abs(mTmpFloats[Matrix.MSCALE_Y]);</span><br><span class="line">     <span class="keyword">int</span> scaledWidth = (<span class="keyword">int</span>) (mTmpBounds.width() * canvasScaleX);</span><br><span class="line">     <span class="keyword">int</span> scaledHeight = (<span class="keyword">int</span>) (mTmpBounds.height() * canvasScaleY);</span><br><span class="line">     scaledWidth = Math.min(MAX_CACHED_BITMAP_SIZE, scaledWidth);</span><br><span class="line">     scaledHeight = Math.min(MAX_CACHED_BITMAP_SIZE, scaledHeight);</span><br><span class="line"></span><br><span class="line">     <span class="keyword">if</span> (scaledWidth &lt;= <span class="number">0</span> || scaledHeight &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">         <span class="keyword">return</span>;</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">final</span> <span class="keyword">int</span> saveCount = canvas.save();</span><br><span class="line">     canvas.translate(mTmpBounds.left, mTmpBounds.top);</span><br><span class="line"></span><br><span class="line">     <span class="comment">// Handle RTL mirroring.</span></span><br><span class="line">     <span class="keyword">final</span> <span class="keyword">boolean</span> needMirroring = needMirroring();</span><br><span class="line">     <span class="keyword">if</span> (needMirroring) &#123;</span><br><span class="line">         canvas.translate(mTmpBounds.width(), <span class="number">0</span>);</span><br><span class="line">         canvas.scale(-<span class="number">1.0f</span>, <span class="number">1.0f</span>);</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="comment">// At this point, canvas has been translated to the right position.</span></span><br><span class="line">     <span class="comment">// And we use this bound for the destination rect for the drawBitmap, so</span></span><br><span class="line">     <span class="comment">// we offset to (0, 0);</span></span><br><span class="line">     mTmpBounds.offsetTo(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">     <span class="comment">//计算获得显示的scaleWidth和scaleHeight</span></span><br><span class="line">     mVectorState.createCachedBitmapIfNeeded(scaledWidth, scaledHeight);</span><br><span class="line">     <span class="keyword">if</span> (!mAllowCaching) &#123;</span><br><span class="line">         mVectorState.updateCachedBitmap(scaledWidth, scaledHeight);</span><br><span class="line">     &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">         <span class="keyword">if</span> (!mVectorState.canReuseCache()) &#123;</span><br><span class="line">             mVectorState.updateCachedBitmap(scaledWidth, scaledHeight);</span><br><span class="line">             mVectorState.updateCacheStates();</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line">     mVectorState.drawCachedBitmapWithRootAlpha(canvas, colorFilter, mTmpBounds);</span><br><span class="line">     canvas.restoreToCount(saveCount);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<h6 id="step-2-调用PathRenderer"><a href="#step-2-调用PathRenderer" class="headerlink" title="step 2:调用PathRenderer"></a>step 2:调用PathRenderer</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateCachedBitmap</span><span class="params">(<span class="keyword">int</span> width, <span class="keyword">int</span> height)</span> </span>&#123;</span><br><span class="line">          mCachedBitmap.eraseColor(Color.TRANSPARENT);</span><br><span class="line">          <span class="comment">//其他的canvas是哪里来的?</span></span><br><span class="line">          Canvas tmpCanvas = <span class="keyword">new</span> Canvas(mCachedBitmap);</span><br><span class="line">          <span class="comment">//画出drawable</span></span><br><span class="line">          mVPathRenderer.draw(tmpCanvas, width, height, <span class="keyword">null</span>);</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>
<h6 id="step-3-递归画路径"><a href="#step-3-递归画路径" class="headerlink" title="step 3:递归画路径"></a>step 3:递归画路径</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">(Canvas canvas, <span class="keyword">int</span> w, <span class="keyword">int</span> h, ColorFilter filter)</span> </span>&#123;</span><br><span class="line">            <span class="comment">// Travese the tree in pre-order to draw.</span></span><br><span class="line">            drawGroupTree(mRootGroup, Matrix.IDENTITY_MATRIX, canvas, w, h, filter);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">drawGroupTree</span><span class="params">(VGroup currentGroup, Matrix currentMatrix,</span></span></span><br><span class="line"><span class="function"><span class="params">                Canvas canvas, <span class="keyword">int</span> w, <span class="keyword">int</span> h, ColorFilter filter)</span> </span>&#123;</span><br><span class="line">            <span class="comment">// Calculate current group's matrix by preConcat the parent's and</span></span><br><span class="line">            <span class="comment">// and the current one on the top of the stack.</span></span><br><span class="line">            <span class="comment">// Basically the Mfinal = Mviewport * M0 * M1 * M2;</span></span><br><span class="line">            <span class="comment">// Mi the local matrix at level i of the group tree.</span></span><br><span class="line">            currentGroup.mStackedMatrix.set(currentMatrix);</span><br><span class="line">            currentGroup.mStackedMatrix.preConcat(currentGroup.mLocalMatrix);</span><br><span class="line">           <span class="comment">//mStackedMatrix本身pre，mLocaMatrix即group的配置转换成matrix</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// Save the current clip information, which is local to this group.</span></span><br><span class="line">            canvas.save();</span><br><span class="line">            <span class="comment">// Draw the group tree in the same order as the XML file.</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; currentGroup.mChildren.size(); i++) &#123;</span><br><span class="line">                Object child = currentGroup.mChildren.get(i);</span><br><span class="line">                <span class="keyword">if</span> (child <span class="keyword">instanceof</span> VGroup) &#123;</span><br><span class="line">                    VGroup childGroup = (VGroup) child;</span><br><span class="line">                    drawGroupTree(childGroup, currentGroup.mStackedMatrix,</span><br><span class="line">                            canvas, w, h, filter);</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (child <span class="keyword">instanceof</span> VPath) &#123;</span><br><span class="line">                    VPath childPath = (VPath) child;</span><br><span class="line">                    drawPath(currentGroup, childPath, canvas, w, h, filter);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            canvas.restore();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">drawPath</span><span class="params">(VGroup vGroup, VPath vPath, Canvas canvas, <span class="keyword">int</span> w, <span class="keyword">int</span> h,</span></span></span><br><span class="line"><span class="function"><span class="params">                ColorFilter filter)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">final</span> <span class="keyword">float</span> scaleX = w / mViewportWidth;</span><br><span class="line">            <span class="keyword">final</span> <span class="keyword">float</span> scaleY = h / mViewportHeight;</span><br><span class="line">            <span class="keyword">final</span> <span class="keyword">float</span> minScale = Math.min(scaleX, scaleY);</span><br><span class="line">            <span class="keyword">final</span> Matrix groupStackedMatrix = vGroup.mStackedMatrix;</span><br><span class="line"></span><br><span class="line">            mFinalPathMatrix.set(groupStackedMatrix);</span><br><span class="line">            mFinalPathMatrix.postScale(scaleX, scaleY);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">final</span> <span class="keyword">float</span> matrixScale = getMatrixScale(groupStackedMatrix);</span><br><span class="line">            <span class="keyword">if</span> (matrixScale == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="comment">// When either x or y is scaled to 0, we don't need to draw anything.</span></span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//important: pathdata 转 path ,use PathParser to transform the node data to path</span></span><br><span class="line">            vPath.toPath(mPath);</span><br><span class="line">            <span class="keyword">final</span> Path path = mPath;</span><br><span class="line"></span><br><span class="line">            mRenderPath.reset();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (vPath.isClipPath()) &#123;</span><br><span class="line">                mRenderPath.addPath(path, mFinalPathMatrix);</span><br><span class="line">                canvas.clipPath(mRenderPath);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                VFullPath fullPath = (VFullPath) vPath;</span><br><span class="line">                <span class="keyword">if</span> (fullPath.mTrimPathStart != <span class="number">0.0f</span> || fullPath.mTrimPathEnd != <span class="number">1.0f</span>) &#123;</span><br><span class="line">                    <span class="keyword">float</span> start = (fullPath.mTrimPathStart + fullPath.mTrimPathOffset) % <span class="number">1.0f</span>;</span><br><span class="line">                    <span class="keyword">float</span> end = (fullPath.mTrimPathEnd + fullPath.mTrimPathOffset) % <span class="number">1.0f</span>;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> (mPathMeasure == <span class="keyword">null</span>) &#123;</span><br><span class="line">                        mPathMeasure = <span class="keyword">new</span> PathMeasure();</span><br><span class="line">                    &#125;</span><br><span class="line">                    mPathMeasure.setPath(mPath, <span class="keyword">false</span>);</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">float</span> len = mPathMeasure.getLength();</span><br><span class="line">                    start = start * len;</span><br><span class="line">                    end = end * len;</span><br><span class="line">                    path.reset();</span><br><span class="line">                    <span class="keyword">if</span> (start &gt; end) &#123;</span><br><span class="line">                        mPathMeasure.getSegment(start, len, path, <span class="keyword">true</span>);</span><br><span class="line">                      <span class="comment">//用pathMeasure截取path中的一段进行展示,moveto Start position</span></span><br><span class="line">                        mPathMeasure.getSegment(<span class="number">0f</span>, end, path, <span class="keyword">true</span>);</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        mPathMeasure.getSegment(start, end, path, <span class="keyword">true</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    path.rLineTo(<span class="number">0</span>, <span class="number">0</span>); <span class="comment">// fix bug in measure</span></span><br><span class="line">                &#125;</span><br><span class="line">                mRenderPath.addPath(path, mFinalPathMatrix);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (fullPath.mFillColor != Color.TRANSPARENT) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (mFillPaint == <span class="keyword">null</span>) &#123;</span><br><span class="line">                        mFillPaint = <span class="keyword">new</span> Paint();</span><br><span class="line">                        mFillPaint.setStyle(Paint.Style.FILL);</span><br><span class="line">                        mFillPaint.setAntiAlias(<span class="keyword">true</span>);</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">final</span> Paint fillPaint = mFillPaint;</span><br><span class="line">                    fillPaint.setColor(applyAlpha(fullPath.mFillColor, fullPath.mFillAlpha));</span><br><span class="line">                    fillPaint.setColorFilter(filter);</span><br><span class="line">                    canvas.drawPath(mRenderPath, fillPaint);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (fullPath.mStrokeColor != Color.TRANSPARENT) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (mStrokePaint == <span class="keyword">null</span>) &#123;</span><br><span class="line">                        mStrokePaint = <span class="keyword">new</span> Paint();</span><br><span class="line">                        mStrokePaint.setStyle(Paint.Style.STROKE);</span><br><span class="line">                        mStrokePaint.setAntiAlias(<span class="keyword">true</span>);</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">final</span> Paint strokePaint = mStrokePaint;</span><br><span class="line">                    <span class="keyword">if</span> (fullPath.mStrokeLineJoin != <span class="keyword">null</span>) &#123;</span><br><span class="line">                        strokePaint.setStrokeJoin(fullPath.mStrokeLineJoin);</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> (fullPath.mStrokeLineCap != <span class="keyword">null</span>) &#123;</span><br><span class="line">                        strokePaint.setStrokeCap(fullPath.mStrokeLineCap);</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    strokePaint.setStrokeMiter(fullPath.mStrokeMiterlimit);</span><br><span class="line">                    strokePaint.setColor(applyAlpha(fullPath.mStrokeColor, fullPath.mStrokeAlpha));</span><br><span class="line">                    strokePaint.setColorFilter(filter);</span><br><span class="line">                    <span class="keyword">final</span> <span class="keyword">float</span> finalStrokeScale = minScale * matrixScale;</span><br><span class="line">                    strokePaint.setStrokeWidth(fullPath.mStrokeWidth * finalStrokeScale);</span><br><span class="line">                    canvas.drawPath(mRenderPath, strokePaint);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<h4 id="GradientDrawable"><a href="#GradientDrawable" class="headerlink" title="GradientDrawable"></a>GradientDrawable</h4><h5 id="Create"><a href="#Create" class="headerlink" title="Create"></a>Create</h5><ol>
<li><p><shape> create GradientDrawable</shape></p>
</li>
<li><p>children’s element</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (name.equals(<span class="string">"size"</span>)) &#123;</span><br><span class="line">               a = obtainAttributes(r, theme, attrs, R.styleable.GradientDrawableSize);</span><br><span class="line">               updateGradientDrawableSize(a);</span><br><span class="line">               a.recycle();</span><br><span class="line">           &#125; <span class="keyword">else</span> <span class="keyword">if</span> (name.equals(<span class="string">"gradient"</span>)) &#123;</span><br><span class="line">               a = obtainAttributes(r, theme, attrs, R.styleable.GradientDrawableGradient);</span><br><span class="line">               updateGradientDrawableGradient(r, a);</span><br><span class="line">               a.recycle();</span><br><span class="line">           &#125; <span class="keyword">else</span> <span class="keyword">if</span> (name.equals(<span class="string">"solid"</span>)) &#123;</span><br><span class="line">               a = obtainAttributes(r, theme, attrs, R.styleable.GradientDrawableSolid);</span><br><span class="line">               updateGradientDrawableSolid(a);</span><br><span class="line">               a.recycle();</span><br><span class="line">           &#125; <span class="keyword">else</span> <span class="keyword">if</span> (name.equals(<span class="string">"stroke"</span>)) &#123;</span><br><span class="line">               a = obtainAttributes(r, theme, attrs, R.styleable.GradientDrawableStroke);</span><br><span class="line">               updateGradientDrawableStroke(a);</span><br><span class="line">               a.recycle();</span><br><span class="line">           &#125; <span class="keyword">else</span> <span class="keyword">if</span> (name.equals(<span class="string">"corners"</span>)) &#123;</span><br><span class="line">               a = obtainAttributes(r, theme, attrs, R.styleable.DrawableCorners);</span><br><span class="line">               updateDrawableCorners(a);</span><br><span class="line">               a.recycle();</span><br><span class="line">           &#125; <span class="keyword">else</span> <span class="keyword">if</span> (name.equals(<span class="string">"padding"</span>)) &#123;</span><br><span class="line">               a = obtainAttributes(r, theme, attrs, R.styleable.GradientDrawablePadding);</span><br><span class="line">               updateGradientDrawablePadding(a);</span><br><span class="line">               a.recycle();</span><br><span class="line">           &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">               Log.w(<span class="string">"drawable"</span>, <span class="string">"Bad element under &lt;shape&gt;: "</span> + name);</span><br><span class="line">           &#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h5 id="Draw"><a href="#Draw" class="headerlink" title="Draw"></a>Draw</h5><p>各种Canvas的基本用法组合[*用以学习Canvas的使用场景]</p>
<h4 id="DrawableContainer"><a href="#DrawableContainer" class="headerlink" title="DrawableContainer"></a>DrawableContainer</h4><h5 id="三个方法四个参数"><a href="#三个方法四个参数" class="headerlink" title="三个方法四个参数"></a>三个方法四个参数</h5><h6 id="Method-1-selectDrawable"><a href="#Method-1-selectDrawable" class="headerlink" title="Method 1:selectDrawable"></a>Method 1:selectDrawable</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">selectDrawable</span><span class="params">(<span class="keyword">int</span> idx)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">if</span> (idx == mCurIndex) &#123;</span><br><span class="line">           <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">final</span> <span class="keyword">long</span> now = SystemClock.uptimeMillis();</span><br><span class="line"></span><br><span class="line">       <span class="keyword">if</span> (DEBUG) android.util.Log.i(TAG, toString() + <span class="string">" from "</span> + mCurIndex + <span class="string">" to "</span> + idx</span><br><span class="line">               + <span class="string">": exit="</span> + mDrawableContainerState.mExitFadeDuration</span><br><span class="line">               + <span class="string">" enter="</span> + mDrawableContainerState.mEnterFadeDuration);</span><br><span class="line"></span><br><span class="line">       <span class="comment">//mDrawableContainerState.mExitFadeDuration get by stateListDrawable enterFadeDuration</span></span><br><span class="line">       <span class="keyword">if</span> (mDrawableContainerState.mExitFadeDuration &gt; <span class="number">0</span>) &#123;</span><br><span class="line">           <span class="keyword">if</span> (mLastDrawable != <span class="keyword">null</span>) &#123;</span><br><span class="line">               mLastDrawable.setVisible(<span class="keyword">false</span>, <span class="keyword">false</span>);</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="keyword">if</span> (mCurrDrawable != <span class="keyword">null</span>) &#123;</span><br><span class="line">               <span class="comment">// swtich drawable and calculate last exit end time</span></span><br><span class="line">               mLastDrawable = mCurrDrawable;</span><br><span class="line">               mLastIndex = mCurIndex;</span><br><span class="line">               mExitAnimationEnd = now + mDrawableContainerState.mExitFadeDuration;</span><br><span class="line">           &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">               mLastDrawable = <span class="keyword">null</span>;</span><br><span class="line">               mLastIndex = -<span class="number">1</span>;</span><br><span class="line">               mExitAnimationEnd = <span class="number">0</span>;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125; <span class="keyword">else</span> <span class="keyword">if</span> (mCurrDrawable != <span class="keyword">null</span>) &#123;</span><br><span class="line">           mCurrDrawable.setVisible(<span class="keyword">false</span>, <span class="keyword">false</span>);</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">if</span> (idx &gt;= <span class="number">0</span> &amp;&amp; idx &lt; mDrawableContainerState.mNumChildren) &#123;</span><br><span class="line">           <span class="keyword">final</span> Drawable d = mDrawableContainerState.getChild(idx);</span><br><span class="line">           <span class="comment">//new current state and calculate last enter time</span></span><br><span class="line">           mCurrDrawable = d;</span><br><span class="line">           mCurIndex = idx;</span><br><span class="line">           <span class="keyword">if</span> (d != <span class="keyword">null</span>) &#123;</span><br><span class="line">               <span class="keyword">if</span> (mDrawableContainerState.mEnterFadeDuration &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                   mEnterAnimationEnd = now + mDrawableContainerState.mEnterFadeDuration;</span><br><span class="line">               &#125;</span><br><span class="line">               <span class="comment">//Initializes a drawable for display in this container</span></span><br><span class="line">               initializeDrawableForDisplay(d);</span><br><span class="line">           &#125;</span><br><span class="line">       &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">           mCurrDrawable = <span class="keyword">null</span>;</span><br><span class="line">           mCurIndex = -<span class="number">1</span>;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">if</span> (mEnterAnimationEnd != <span class="number">0</span> || mExitAnimationEnd != <span class="number">0</span>) &#123;</span><br><span class="line">           <span class="keyword">if</span> (mAnimationRunnable == <span class="keyword">null</span>) &#123;</span><br><span class="line">               mAnimationRunnable = <span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">                   <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                       <span class="comment">//do animating</span></span><br><span class="line">                       animate(<span class="keyword">true</span>);</span><br><span class="line">                       invalidateSelf();</span><br><span class="line">                   &#125;</span><br><span class="line">               &#125;;</span><br><span class="line">           &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">               unscheduleSelf(mAnimationRunnable);</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="comment">// Compute first frame and schedule next animation.</span></span><br><span class="line">           animate(<span class="keyword">true</span>);</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       invalidateSelf();</span><br><span class="line"></span><br><span class="line">       <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<h6 id="Method-2-animate"><a href="#Method-2-animate" class="headerlink" title="Method 2 animate:"></a>Method 2 animate:</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"> <span class="function"><span class="keyword">void</span> <span class="title">animate</span><span class="params">(<span class="keyword">boolean</span> schedule)</span> </span>&#123;</span><br><span class="line">    mHasAlpha = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">long</span> now = SystemClock.uptimeMillis();</span><br><span class="line">    <span class="keyword">boolean</span> animating = <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">if</span> (mCurrDrawable != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (mEnterAnimationEnd != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (mEnterAnimationEnd &lt;= now) &#123;</span><br><span class="line">                mCurrDrawable.mutate().setAlpha(mAlpha);</span><br><span class="line">                mEnterAnimationEnd = <span class="number">0</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">int</span> animAlpha = (<span class="keyword">int</span>)((mEnterAnimationEnd-now)*<span class="number">255</span>)</span><br><span class="line">                        / mDrawableContainerState.mEnterFadeDuration;</span><br><span class="line">                <span class="keyword">if</span> (DEBUG) android.util.Log.i(TAG, toString() + <span class="string">" cur alpha "</span> + animAlpha);</span><br><span class="line">                <span class="comment">// be clearer with percent enter</span></span><br><span class="line">                mCurrDrawable.mutate().setAlpha(((<span class="number">255</span>-animAlpha)*mAlpha)/<span class="number">255</span>);</span><br><span class="line">                animating = <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        mEnterAnimationEnd = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (mLastDrawable != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (mExitAnimationEnd != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (mExitAnimationEnd &lt;= now) &#123;</span><br><span class="line">                mLastDrawable.setVisible(<span class="keyword">false</span>, <span class="keyword">false</span>);</span><br><span class="line">                mLastDrawable = <span class="keyword">null</span>;</span><br><span class="line">                mLastIndex = -<span class="number">1</span>;</span><br><span class="line">                mExitAnimationEnd = <span class="number">0</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">int</span> animAlpha = (<span class="keyword">int</span>)((mExitAnimationEnd-now)*<span class="number">255</span>)</span><br><span class="line">                        / mDrawableContainerState.mExitFadeDuration;</span><br><span class="line">                <span class="keyword">if</span> (DEBUG) android.util.Log.i(TAG, toString() + <span class="string">" last alpha "</span> + animAlpha);</span><br><span class="line">                <span class="comment">// be more  transparent with percent exit</span></span><br><span class="line">                mLastDrawable.mutate().setAlpha((animAlpha*mAlpha)/<span class="number">255</span>);</span><br><span class="line">                animating = <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        mExitAnimationEnd = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (schedule &amp;&amp; animating) &#123;</span><br><span class="line">        scheduleSelf(mAnimationRunnable, now + <span class="number">1000</span> / <span class="number">60</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="Method-3-initializeDrawableForDisplay"><a href="#Method-3-initializeDrawableForDisplay" class="headerlink" title="Method 3  initializeDrawableForDisplay:"></a>Method 3  initializeDrawableForDisplay:</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * Initializes a drawable for display in this container.</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> d The drawable to initialize.</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initializeDrawableForDisplay</span><span class="params">(Drawable d)</span> </span>&#123;</span><br><span class="line">       d.mutate();</span><br><span class="line"></span><br><span class="line">       <span class="keyword">if</span> (mDrawableContainerState.mEnterFadeDuration &lt;= <span class="number">0</span> &amp;&amp; mHasAlpha) &#123;</span><br><span class="line">           d.setAlpha(mAlpha);</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">if</span> (mDrawableContainerState.mHasColorFilter) &#123;</span><br><span class="line">           <span class="comment">// Color filter always overrides tint.</span></span><br><span class="line">           d.setColorFilter(mDrawableContainerState.mColorFilter);</span><br><span class="line">       &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">           <span class="keyword">if</span> (mDrawableContainerState.mHasTintList) &#123;</span><br><span class="line">               d.setTintList(mDrawableContainerState.mTintList);</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="keyword">if</span> (mDrawableContainerState.mHasTintMode) &#123;</span><br><span class="line">               d.setTintMode(mDrawableContainerState.mTintMode);</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       d.setVisible(isVisible(), <span class="keyword">true</span>);</span><br><span class="line">       d.setDither(mDrawableContainerState.mDither);</span><br><span class="line">       d.setState(getState());</span><br><span class="line">       d.setLevel(getLevel());</span><br><span class="line">       d.setBounds(getBounds());</span><br><span class="line">       d.setLayoutDirection(getLayoutDirection());</span><br><span class="line">       d.setAutoMirrored(mDrawableContainerState.mAutoMirrored);</span><br><span class="line"></span><br><span class="line">       <span class="keyword">final</span> Rect hotspotBounds = mHotspotBounds;</span><br><span class="line">       <span class="keyword">if</span> (hotspotBounds != <span class="keyword">null</span>) &#123;</span><br><span class="line">           d.setHotspotBounds(hotspotBounds.left, hotspotBounds.top,</span><br><span class="line">                   hotspotBounds.right, hotspotBounds.bottom);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<h6 id="Parameters"><a href="#Parameters" class="headerlink" title="Parameters:"></a>Parameters:</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Drawable mCurrDrawable;<span class="comment">//管理前后状态</span></span><br><span class="line"><span class="keyword">private</span> Drawable mLastDrawable;<span class="comment">//管理前后状态</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> mCurIndex = -<span class="number">1</span>;<span class="comment">//管理前后状态</span></span><br><span class="line">Drawable[] mDrawables;<span class="comment">//所有的drawable数组</span></span><br></pre></td></tr></table></figure>
<h5 id="子类们"><a href="#子类们" class="headerlink" title="子类们"></a>子类们</h5><h6 id="AnimatableDrawable"><a href="#AnimatableDrawable" class="headerlink" title="AnimatableDrawable"></a>AnimatableDrawable</h6><ol>
<li><p>xmlTag</p>
<p>Drawable:createFromXmlInner(Resources , XmlPullParser, AttributeSet, Theme)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">* &lt;pre&gt;</span><br><span class="line"> * &lt;!-- Animation frames are wheel0.png through wheel5.png</span><br><span class="line"> *     files inside the res/drawable/ folder --&gt;</span><br><span class="line"> * &lt;animation-list android:id=<span class="string">"@+id/selected"</span> android:oneshot=<span class="string">"false"</span>&gt;</span><br><span class="line"> *    &lt;item android:drawable=<span class="string">"@drawable/wheel0"</span> android:duration=<span class="string">"50"</span> /&gt;</span><br><span class="line"> *    &lt;item android:drawable=<span class="string">"@drawable/wheel1"</span> android:duration=<span class="string">"50"</span> /&gt;</span><br><span class="line"> *    &lt;item android:drawable=<span class="string">"@drawable/wheel2"</span> android:duration=<span class="string">"50"</span> /&gt;</span><br><span class="line"> *    &lt;item android:drawable=<span class="string">"@drawable/wheel3"</span> android:duration=<span class="string">"50"</span> /&gt;</span><br><span class="line"> *    &lt;item android:drawable=<span class="string">"@drawable/wheel4"</span> android:duration=<span class="string">"50"</span> /&gt;</span><br><span class="line"> *    &lt;item android:drawable=<span class="string">"@drawable/wheel5"</span> android:duration=<span class="string">"50"</span> /&gt;</span><br><span class="line"> * &lt;/animation-list&gt;&lt;/pre&gt;</span><br><span class="line"> * &lt;p&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>切换流程</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">start -&gt; run -&gt; nextFrame -&gt; setFrame -&gt; scheduleSelf(Runnable,when)</span><br></pre></td></tr></table></figure>
<h6 id="scheduleDrawable的实现"><a href="#scheduleDrawable的实现" class="headerlink" title="scheduleDrawable的实现"></a>scheduleDrawable的实现</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.通过 View:setBackgroudDrawable 中的  background.setCallback(this);</span></span><br><span class="line"><span class="comment">// 2.成功 回调View:scheduleDrawable</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Schedules an action on a drawable to occur at a specified time.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> who the recipient of the action</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> what the action to run on the drawable</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> when the time at which the action must occur. Uses the</span></span><br><span class="line"><span class="comment">     *        &#123;<span class="doctag">@link</span> SystemClock#uptimeMillis&#125; timebase.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">scheduleDrawable</span><span class="params">(Drawable who, Runnable what, <span class="keyword">long</span> when)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (verifyDrawable(who) &amp;&amp; what != <span class="keyword">null</span>) &#123;</span><br><span class="line">          <span class="comment">//updatimeMillis开机后的经过的时间，不包括深度睡眠的时间,delay 约为duration</span></span><br><span class="line">            <span class="keyword">final</span> <span class="keyword">long</span> delay = when - SystemClock.uptimeMillis();</span><br><span class="line">            <span class="keyword">if</span> (mAttachInfo != <span class="keyword">null</span>) &#123;</span><br><span class="line">                mAttachInfo.mViewRootImpl.mChoreographer.postCallbackDelayed(</span><br><span class="line">                        Choreographer.CALLBACK_ANIMATION, what, who,</span><br><span class="line">                        Choreographer.subtractFrameDelay(delay));</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">              <span class="comment">//下一个frame，what = animationDrawable run nextFrame</span></span><br><span class="line">                ViewRootImpl.getRunQueue().postDelayed(what, delay);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>​</p>
</li>
<li><p>mRunnig vs Animating</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** Whether the drawable has an animation callback posted. */</span><span class="comment">//是否有callback被posted</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">boolean</span> mRunning;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** Whether the drawable should animate when visible. */</span><span class="comment">//可视状态是否需要继续执行动画</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">boolean</span> mAnimating;</span><br></pre></td></tr></table></figure>
<p>​</p>
</li>
</ol>
<h6 id="LevelListDrawable"><a href="#LevelListDrawable" class="headerlink" title="LevelListDrawable"></a>LevelListDrawable</h6><ol>
<li><p>xmlTag</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * A resource that manages a number of alternate Drawables, each assigned a maximum numerical value.</span></span><br><span class="line"><span class="comment"> * Setting the level value of the object with &#123;<span class="doctag">@link</span> #setLevel(int)&#125; will load the image with the next</span></span><br><span class="line"><span class="comment"> * greater or equal value assigned to its max attribute.</span></span><br><span class="line"><span class="comment"> * A good example use of</span></span><br><span class="line"><span class="comment"> * a LevelListDrawable would be a battery level indicator icon, with different images to indicate the current</span></span><br><span class="line"><span class="comment"> * battery level.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * It can be defined in an XML file with the &lt;code&gt;&lt;level-list&gt;&lt;/code&gt; element.</span></span><br><span class="line"><span class="comment"> * Each Drawable level is defined in a nested &lt;code&gt;&lt;item&gt;&lt;/code&gt;. For example:</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;pre&gt;</span></span><br><span class="line"><span class="comment"> * &lt;level-list xmlns:android="http://schemas.android.com/apk/res/android"&gt;</span></span><br><span class="line"><span class="comment"> *  &lt;item android:maxLevel="0" android:drawable="<span class="doctag">@drawable</span>/ic_wifi_signal_1" /&gt;</span></span><br><span class="line"><span class="comment"> *  &lt;item android:maxLevel="1" android:drawable="<span class="doctag">@drawable</span>/ic_wifi_signal_2" /&gt;</span></span><br><span class="line"><span class="comment"> *  &lt;item android:maxLevel="2" android:drawable="<span class="doctag">@drawable</span>/ic_wifi_signal_3" /&gt;</span></span><br><span class="line"><span class="comment"> *  &lt;item android:maxLevel="3" android:drawable="<span class="doctag">@drawable</span>/ic_wifi_signal_4" /&gt;</span></span><br><span class="line"><span class="comment"> * &lt;/level-list&gt;</span></span><br><span class="line"><span class="comment"> *&lt;/pre&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;With this XML saved into the res/drawable/ folder of the project, it can be referenced as</span></span><br><span class="line"><span class="comment"> * the drawable for an &#123;<span class="doctag">@link</span> android.widget.ImageView&#125;. The default image is the first in the list.</span></span><br><span class="line"><span class="comment"> * It can then be changed to one of the other levels with</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@link</span> android.widget.ImageView#setImageLevel(int)&#125;. For more</span></span><br><span class="line"><span class="comment"> * information, see the guide to &lt;a</span></span><br><span class="line"><span class="comment"> * href="&#123;<span class="doctag">@docRoot</span>&#125;guide/topics/resources/drawable-resource.html"&gt;Drawable Resources&lt;/a&gt;.&lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@attr</span> ref android.R.styleable#LevelListDrawableItem_minLevel</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@attr</span> ref android.R.styleable#LevelListDrawableItem_maxLevel</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@attr</span> ref android.R.styleable#LevelListDrawableItem_drawable</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>onLevelChange</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//private int[] mLows;  //use to stroe drawable level zone by pos</span></span><br><span class="line"><span class="comment">//private int[] mHighs;  //use to store drawable level zone by pos</span></span><br><span class="line"></span><br><span class="line"> <span class="comment">/** </span></span><br><span class="line"><span class="comment"> invoke by setLevel on any other method and then find the most match child to display</span></span><br><span class="line"><span class="comment"> by the mLows and mHighs </span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">onLevelChange</span><span class="params">(<span class="keyword">int</span> level)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">int</span> idx = mLevelListState.indexOfLevel(level);</span><br><span class="line">      <span class="keyword">if</span> (selectDrawable(idx)) &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">super</span>.onLevelChange(level);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h6 id="StateListDrawable"><a href="#StateListDrawable" class="headerlink" title="StateListDrawable"></a>StateListDrawable</h6><ol>
<li><p>how to inflater</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Lets you assign a number of graphic images to a single Drawable and swap out the visible item by a string</span></span><br><span class="line"><span class="comment"> * ID value.</span></span><br><span class="line"><span class="comment"> * &lt;p/&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;It can be defined in an XML file with the &lt;code&gt;&lt;selector&gt;&lt;/code&gt; element.</span></span><br><span class="line"><span class="comment"> * Each state Drawable is defined in a nested &lt;code&gt;&lt;item&gt;&lt;/code&gt; element. For more</span></span><br><span class="line"><span class="comment"> * information, see the guide to &lt;a</span></span><br><span class="line"><span class="comment"> * href="&#123;<span class="doctag">@docRoot</span>&#125;guide/topics/resources/drawable-resource.html"&gt;Drawable Resources&lt;/a&gt;.&lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@attr</span> ref android.R.styleable#StateListDrawable_visible</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@attr</span> ref android.R.styleable#StateListDrawable_variablePadding</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@attr</span> ref android.R.styleable#StateListDrawable_constantSize</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@attr</span> ref android.R.styleable#DrawableStates_state_focused</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@attr</span> ref android.R.styleable#DrawableStates_state_window_focused</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@attr</span> ref android.R.styleable#DrawableStates_state_enabled</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@attr</span> ref android.R.styleable#DrawableStates_state_checkable</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@attr</span> ref android.R.styleable#DrawableStates_state_checked</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@attr</span> ref android.R.styleable#DrawableStates_state_selected</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@attr</span> ref android.R.styleable#DrawableStates_state_activated</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@attr</span> ref android.R.styleable#DrawableStates_state_active</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@attr</span> ref android.R.styleable#DrawableStates_state_single</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@attr</span> ref android.R.styleable#DrawableStates_state_first</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@attr</span> ref android.R.styleable#DrawableStates_state_middle</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@attr</span> ref android.R.styleable#DrawableStates_state_last</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@attr</span> ref android.R.styleable#DrawableStates_state_pressed</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">// use StateSet to initial state array</span></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="comment">// store in  int[][] mStateSets;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Extracts state_ attributes from an attribute set.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> attrs The attribute set.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> An array of state_ attributes.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">int</span>[] extractStateSet(AttributeSet attrs) &#123;</span><br><span class="line">        <span class="keyword">int</span> j = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> numAttrs = attrs.getAttributeCount();</span><br><span class="line">        <span class="keyword">int</span>[] states = <span class="keyword">new</span> <span class="keyword">int</span>[numAttrs];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; numAttrs; i++) &#123;</span><br><span class="line">            <span class="keyword">final</span> <span class="keyword">int</span> stateResId = attrs.getAttributeNameResource(i);</span><br><span class="line">            <span class="keyword">switch</span> (stateResId) &#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> R.attr.drawable:</span><br><span class="line">                <span class="keyword">case</span> R.attr.id:</span><br><span class="line">                    <span class="comment">// Ignore attributes from StateListDrawableItem and</span></span><br><span class="line">                    <span class="comment">// AnimatedStateListDrawableItem.</span></span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                    states[j++] = attrs.getAttributeBooleanValue(i, <span class="keyword">false</span>)</span><br><span class="line">                            ? stateResId : -stateResId;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        states = StateSet.trimStateSet(states, j);</span><br><span class="line">        <span class="keyword">return</span> states;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">​    </span><br><span class="line"></span><br><span class="line">2. onStateChange</span><br><span class="line"></span><br><span class="line">   ```java</span><br><span class="line">   View:onTouchEvent()-&gt;setPressed()-&gt;refreshDrawableState()-&gt;drawableStateChange()-&gt;setState()</span><br></pre></td></tr></table></figure>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><span class="line">	<span class="comment">//View</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">drawableStateChanged</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="comment">//here to generate the current Drawable State</span></span><br><span class="line">      <span class="keyword">final</span> <span class="keyword">int</span>[] state = getDrawableState();</span><br><span class="line"></span><br><span class="line">      <span class="keyword">final</span> Drawable bg = mBackground;</span><br><span class="line">      <span class="keyword">if</span> (bg != <span class="keyword">null</span> &amp;&amp; bg.isStateful()) &#123;</span><br><span class="line">          bg.setState(state);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">final</span> Drawable fg = mForegroundInfo != <span class="keyword">null</span> ? mForegroundInfo.mDrawable : <span class="keyword">null</span>;</span><br><span class="line">      <span class="keyword">if</span> (fg != <span class="keyword">null</span> &amp;&amp; fg.isStateful()) &#123;</span><br><span class="line">          fg.setState(state);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (mScrollCache != <span class="keyword">null</span>) &#123;</span><br><span class="line">          <span class="keyword">final</span> Drawable scrollBar = mScrollCache.scrollBar;</span><br><span class="line">          <span class="keyword">if</span> (scrollBar != <span class="keyword">null</span> &amp;&amp; scrollBar.isStateful()) &#123;</span><br><span class="line">              scrollBar.setState(state);</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (mStateListAnimator != <span class="keyword">null</span>) &#123;</span><br><span class="line">          mStateListAnimator.setState(state);</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Return an array of resource IDs of the drawable states representing the</span></span><br><span class="line"><span class="comment">   * current state of the view.</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@return</span> The current drawable state</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@see</span> Drawable#setState(int[])</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@see</span> #drawableStateChanged()</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@see</span> #onCreateDrawableState(int)</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">int</span>[] getDrawableState() &#123;</span><br><span class="line">      <span class="keyword">if</span> ((mDrawableState != <span class="keyword">null</span>) &amp;&amp; ((mPrivateFlags &amp; PFLAG_DRAWABLE_STATE_DIRTY) == <span class="number">0</span>)) &#123;</span><br><span class="line">        <span class="comment">//no change</span></span><br><span class="line">          <span class="keyword">return</span> mDrawableState;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// genearate new current Drawablestate</span></span><br><span class="line">          mDrawableState = onCreateDrawableState(<span class="number">0</span>);</span><br><span class="line">          mPrivateFlags &amp;= ~PFLAG_DRAWABLE_STATE_DIRTY;</span><br><span class="line">          <span class="keyword">return</span> mDrawableState;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Generate the new &#123;<span class="doctag">@link</span> android.graphics.drawable.Drawable&#125; state for</span></span><br><span class="line"><span class="comment">   * this view. This is called by the view</span></span><br><span class="line"><span class="comment">   * system when the cached Drawable state is determined to be invalid.  To</span></span><br><span class="line"><span class="comment">   * retrieve the current state, you should use &#123;<span class="doctag">@link</span> #getDrawableState&#125;.</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> extraSpace if non-zero, this is the number of extra entries you</span></span><br><span class="line"><span class="comment">   * would like in the returned array in which you can place your own</span></span><br><span class="line"><span class="comment">   * states.</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@return</span> Returns an array holding the current &#123;<span class="doctag">@link</span> Drawable&#125; state of</span></span><br><span class="line"><span class="comment">   * the view.</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@see</span> #mergeDrawableStates(int[], int[])</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">protected</span> <span class="keyword">int</span>[] onCreateDrawableState(<span class="keyword">int</span> extraSpace) &#123;</span><br><span class="line">      <span class="keyword">if</span> ((mViewFlags &amp; DUPLICATE_PARENT_STATE) == DUPLICATE_PARENT_STATE &amp;&amp;</span><br><span class="line">              mParent <span class="keyword">instanceof</span> View) &#123;</span><br><span class="line">          <span class="keyword">return</span> ((View) mParent).onCreateDrawableState(extraSpace);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">int</span>[] drawableState;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">int</span> privateFlags = mPrivateFlags;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">int</span> viewStateIndex = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">if</span> ((privateFlags &amp; PFLAG_PRESSED) != <span class="number">0</span>) viewStateIndex |= StateSet.VIEW_STATE_PRESSED;</span><br><span class="line">      <span class="keyword">if</span> ((mViewFlags &amp; ENABLED_MASK) == ENABLED) viewStateIndex |= StateSet.VIEW_STATE_ENABLED;</span><br><span class="line">      <span class="keyword">if</span> (isFocused()) viewStateIndex |= StateSet.VIEW_STATE_FOCUSED;</span><br><span class="line">      <span class="keyword">if</span> ((privateFlags &amp; PFLAG_SELECTED) != <span class="number">0</span>) viewStateIndex |= StateSet.VIEW_STATE_SELECTED;</span><br><span class="line">      <span class="keyword">if</span> (hasWindowFocus()) viewStateIndex |= StateSet.VIEW_STATE_WINDOW_FOCUSED;</span><br><span class="line">      <span class="keyword">if</span> ((privateFlags &amp; PFLAG_ACTIVATED) != <span class="number">0</span>) viewStateIndex |=             StateSet.VIEW_STATE_ACTIVATED;</span><br><span class="line">      <span class="keyword">if</span> (mAttachInfo != <span class="keyword">null</span> &amp;&amp; mAttachInfo.mHardwareAccelerationRequested &amp;&amp;</span><br><span class="line">              HardwareRenderer.isAvailable()) &#123;</span><br><span class="line">          <span class="comment">// This is set if HW acceleration is requested, even if the current</span></span><br><span class="line">          <span class="comment">// process doesn't allow it.  This is just to allow app preview</span></span><br><span class="line">          <span class="comment">// windows to better match their app.</span></span><br><span class="line">          viewStateIndex |= StateSet.VIEW_STATE_ACCELERATED;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> ((privateFlags &amp; PFLAG_HOVERED) != <span class="number">0</span>) viewStateIndex |= StateSet.VIEW_STATE_HOVERED;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">final</span> <span class="keyword">int</span> privateFlags2 = mPrivateFlags2;</span><br><span class="line">      <span class="keyword">if</span> ((privateFlags2 &amp; PFLAG2_DRAG_CAN_ACCEPT) != <span class="number">0</span>) &#123;</span><br><span class="line">          viewStateIndex |= StateSet.VIEW_STATE_DRAG_CAN_ACCEPT;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> ((privateFlags2 &amp; PFLAG2_DRAG_HOVERED) != <span class="number">0</span>) &#123;</span><br><span class="line">          viewStateIndex |= StateSet.VIEW_STATE_DRAG_HOVERED;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      drawableState = StateSet.get(viewStateIndex);</span><br><span class="line"></span><br><span class="line">      <span class="comment">//noinspection ConstantIfStatement</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">false</span>) &#123;</span><br><span class="line">          Log.i(<span class="string">"View"</span>, <span class="string">"drawableStateIndex="</span> + viewStateIndex);</span><br><span class="line">          Log.i(<span class="string">"View"</span>, toString()</span><br><span class="line">                  + <span class="string">" pressed="</span> + ((privateFlags &amp; PFLAG_PRESSED) != <span class="number">0</span>)</span><br><span class="line">                  + <span class="string">" en="</span> + ((mViewFlags &amp; ENABLED_MASK) == ENABLED)</span><br><span class="line">                  + <span class="string">" fo="</span> + hasFocus()</span><br><span class="line">                  + <span class="string">" sl="</span> + ((privateFlags &amp; PFLAG_SELECTED) != <span class="number">0</span>)</span><br><span class="line">                  + <span class="string">" wf="</span> + hasWindowFocus()</span><br><span class="line">                  + <span class="string">": "</span> + Arrays.toString(drawableState));</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (extraSpace == <span class="number">0</span>) &#123;</span><br><span class="line">          <span class="keyword">return</span> drawableState;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">final</span> <span class="keyword">int</span>[] fullState;</span><br><span class="line">      <span class="keyword">if</span> (drawableState != <span class="keyword">null</span>) &#123;</span><br><span class="line">          fullState = <span class="keyword">new</span> <span class="keyword">int</span>[drawableState.length + extraSpace];</span><br><span class="line">          System.arraycopy(drawableState, <span class="number">0</span>, fullState, <span class="number">0</span>, drawableState.length);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          fullState = <span class="keyword">new</span> <span class="keyword">int</span>[extraSpace];</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> fullState;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//invoke StateListDrawable:onStateChange at last</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">onStateChange</span><span class="params">(<span class="keyword">int</span>[] stateSet)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">boolean</span> changed = <span class="keyword">super</span>.onStateChange(stateSet);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> idx = mStateListState.indexOfStateSet(stateSet);</span><br><span class="line">    <span class="keyword">if</span> (DEBUG) android.util.Log.i(TAG, <span class="string">"onStateChange "</span> + <span class="keyword">this</span> + <span class="string">" states "</span></span><br><span class="line">            + Arrays.toString(stateSet) + <span class="string">" found "</span> + idx);</span><br><span class="line">    <span class="keyword">if</span> (idx &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        idx = mStateListState.indexOfStateSet(StateSet.WILD_CARD);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> selectDrawable(idx) || changed;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h5><h6 id="展示"><a href="#展示" class="headerlink" title="展示"></a>展示</h6><p>DrawableContainer 子类分2类:一类主动刷新的，如AnimationDrawable,通过scheduleDrawable的方式控制每个drawable的展示时间,由View的scheduleDrawable控制流程，由自身的nextFrame控制展示的内容；另一类是被动刷新的,如stateListDrawable,由View保存并控制状态变脸,由自身在onStateChange中找出之前inflater保存的 mStateSets[][]最匹配drawable</p>
<h6 id="生成"><a href="#生成" class="headerlink" title="生成"></a>生成</h6><ol>
<li>通过updateStateFromTypeArray获得外层属性</li>
<li>通过inflateChildrenElement填充Drawable数组</li>
<li>自身的state内部类保存选择drawable条件的相关数据,DrawableContainer的state保存所有drawable数组以及显示的bounds，level等参数</li>
</ol>

      
    </div>
    
    
    

    

    

    
      <div>
        <ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者：</strong>
    Jinjian
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="http://jinjian.info/2017/08/17/Drawable源码解读/" title="Drawable源码解读">http://jinjian.info/2017/08/17/Drawable源码解读/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>
    本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 3.0</a> 许可协议。转载请注明出处！
  </li>
</ul>

      </div>
    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/RTFSC-Read-the-fucking-source-code/" rel="tag"># RTFSC (Read the fucking source code )</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/08/13/ViewGroup源码解读/" rel="next" title="ViewGroup源码解读">
                <i class="fa fa-chevron-left"></i> ViewGroup源码解读
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/09/10/canvas的使用/" rel="prev" title="关于canvas的使用">
                关于canvas的使用 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/my_logo.svg"
                alt="Jinjian" />
            
              <p class="site-author-name" itemprop="name">Jinjian</p>
              <p class="site-description motion-element" itemprop="description">Practice Makes Perfect</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">27</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">7</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">7</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/jinjiankla" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:jinjiankla0203@126.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://stackoverflow.com/users/8689674/user8689674" target="_blank" title="StackOverflow">
                      
                        <i class="fa fa-fw fa-stack-overflow"></i>StackOverflow</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#前言"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Drawable方法论"><span class="nav-number">2.</span> <span class="nav-text">Drawable方法论</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#分类"><span class="nav-number">2.1.</span> <span class="nav-text">分类</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Drawable的子类们"><span class="nav-number">3.</span> <span class="nav-text">Drawable的子类们</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#大纲"><span class="nav-number">3.1.</span> <span class="nav-text">大纲</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ShapeDrawable"><span class="nav-number">3.2.</span> <span class="nav-text">ShapeDrawable</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#draw"><span class="nav-number">3.2.1.</span> <span class="nav-text">draw</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#onDraw"><span class="nav-number">3.2.2.</span> <span class="nav-text">onDraw</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#shape与shapeDrawable"><span class="nav-number">3.2.3.</span> <span class="nav-text">shape与shapeDrawable</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#ShapeState"><span class="nav-number">3.2.4.</span> <span class="nav-text">ShapeState</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ColorDrawable"><span class="nav-number">3.3.</span> <span class="nav-text">ColorDrawable</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#draw-1"><span class="nav-number">3.3.1.</span> <span class="nav-text">draw</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#BitmapDrawable"><span class="nav-number">3.4.</span> <span class="nav-text">BitmapDrawable</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#draw-2"><span class="nav-number">3.4.1.</span> <span class="nav-text">draw</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#LayerDrawable"><span class="nav-number">3.5.</span> <span class="nav-text">LayerDrawable</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#draw-3"><span class="nav-number">3.5.1.</span> <span class="nav-text">draw</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#LayerState"><span class="nav-number">3.5.2.</span> <span class="nav-text">LayerState</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#VertorDrawable"><span class="nav-number">3.6.</span> <span class="nav-text">VertorDrawable</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#如何建立矢量树"><span class="nav-number">3.6.1.</span> <span class="nav-text">如何建立矢量树</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#相关类"><span class="nav-number">3.6.1.1.</span> <span class="nav-text">相关类</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#建树"><span class="nav-number">3.6.1.2.</span> <span class="nav-text">建树</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#如何画"><span class="nav-number">3.6.2.</span> <span class="nav-text">如何画</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#step-1-确定canvas-的宽高"><span class="nav-number">3.6.2.1.</span> <span class="nav-text">step 1: 确定canvas 的宽高</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#step-2-调用PathRenderer"><span class="nav-number">3.6.2.2.</span> <span class="nav-text">step 2:调用PathRenderer</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#step-3-递归画路径"><span class="nav-number">3.6.2.3.</span> <span class="nav-text">step 3:递归画路径</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#GradientDrawable"><span class="nav-number">3.7.</span> <span class="nav-text">GradientDrawable</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Create"><span class="nav-number">3.7.1.</span> <span class="nav-text">Create</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Draw"><span class="nav-number">3.7.2.</span> <span class="nav-text">Draw</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#DrawableContainer"><span class="nav-number">3.8.</span> <span class="nav-text">DrawableContainer</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#三个方法四个参数"><span class="nav-number">3.8.1.</span> <span class="nav-text">三个方法四个参数</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#Method-1-selectDrawable"><span class="nav-number">3.8.1.1.</span> <span class="nav-text">Method 1:selectDrawable</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#Method-2-animate"><span class="nav-number">3.8.1.2.</span> <span class="nav-text">Method 2 animate:</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#Method-3-initializeDrawableForDisplay"><span class="nav-number">3.8.1.3.</span> <span class="nav-text">Method 3  initializeDrawableForDisplay:</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#Parameters"><span class="nav-number">3.8.1.4.</span> <span class="nav-text">Parameters:</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#子类们"><span class="nav-number">3.8.2.</span> <span class="nav-text">子类们</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#AnimatableDrawable"><span class="nav-number">3.8.2.1.</span> <span class="nav-text">AnimatableDrawable</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#scheduleDrawable的实现"><span class="nav-number">3.8.2.2.</span> <span class="nav-text">scheduleDrawable的实现</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#LevelListDrawable"><span class="nav-number">3.8.2.3.</span> <span class="nav-text">LevelListDrawable</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#StateListDrawable"><span class="nav-number">3.8.2.4.</span> <span class="nav-text">StateListDrawable</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#总结"><span class="nav-number">3.8.3.</span> <span class="nav-text">总结</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#展示"><span class="nav-number">3.8.3.1.</span> <span class="nav-text">展示</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#生成"><span class="nav-number">3.8.3.2.</span> <span class="nav-text">生成</span></a></li></ol></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jinjian</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.4</div>




        
 <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?ddb5ad830b0accecaab2b551afd8c824";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
